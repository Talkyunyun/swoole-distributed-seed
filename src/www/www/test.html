<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>WebSocket Demo</title>
</head>
<body>


<button type="button" class="join" data-id="1">加入房间1</button>

<button type="button" class="join" data-id="2">加入房间2</button>

<button type="button" id="send">发送信息</button>

<script src="https://cdn.bootcss.com/jquery/2.0.1/jquery.min.js"></script>
<script>
var ws;
var uid  = getUrlString('uid');
var host = '127.0.0.1';
var port = 8081;
var data = new Object();
data.controller_name = 'WebSocket';
data.method_name = '';
$(function() {
    if (!window.WebSocket) {
        alert('您的浏览器不支持实时聊天');
    }
    ws = new WebSocket('ws://' + host + ':' + port);
    // 初始化信息
    ws.onopen = function(e) {
        data.method_name = 'init';
        data.uid = uid;
        ws.send(JSON.stringify(data));
    }


    // 消息监听
    ws.onmessage = function(e) {
        var data = JSON.parse(e.data);
        console.log('接收到消息:', data);
    }

    ws.onclose = function(e) {
        console.log('断开连接,尝试第1次连接');
    }


    ws.onerror = function(e) {
        alert('无法链接服务器');
    }


    // 加入房间
    $('.join').click(function() {
        data.method_name = 'join';
        data.room_id = $(this).attr('data-id');

        ws.send(JSON.stringify(data));
    });

    // 发送消息
    $('#send').click(function() {
        data.method_name = 'message';
        data.msg = '哈哈 ,我来自客户端哦';

        ws.send(JSON.stringify(data));
    });
});


function getUrlString(name){
    var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)" );
    var r = window.location.search.substr( 1).match(reg);
    if(r!= null)return  unescape(r[2]); return null;
}
</script>
</body>
</html>